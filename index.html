<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>專案法IRR計算網頁</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- 主容器 -->
    <div class="container">
        <!-- 頁面標題區域 -->
        <div class="header">
            <h1>📊 專案法IRR 投資報酬率計算器</h1>
            <p>內部報酬率計算工具 - 專業版</p>
        </div>

        <!-- 主要內容區域 -->
        <div class="content">
            <!-- 輸入參數區域 -->
            <div class="input-section">
                <h2 class="section-title">💰 收入與支出設定</h2>

                <!-- 年度範圍設定 -->
                <div class="input-group">
                    <label class="input-label">📅 年度範圍</label>
                    <div class="year-input-container">
                        <input type="number" id="start_year" placeholder="起始年度" value="2025">
                        <span>~</span>
                        <input type="number" id="end_year" placeholder="結束年度" value="2030">
                    </div>
                    <div class="help-text">設定投資計畫的年度範圍</div>
                </div>

                <!-- 設備費用計算區域 -->
                <div class="input-group">
                    <label class="input-label">🏭 設備費用計算 (初始投資)</label>
                    <div class="equipment-grid">
                        <div>
                            <label>建置容量 (KW)</label>
                            <input type="number" id="capacity" placeholder="例: 100" step="0.01" oninput="calculate_equipment_cost()">
                        </div>
                        <div>
                            <label>每KW價格</label>
                            <input type="number" id="price_per_kw" placeholder="例: 45000" step="0.01" oninput="calculate_equipment_cost()">
                        </div>
                        <div>
                            <label>利潤率 (%)</label>
                            <input type="number" id="profit_rate" placeholder="例: 15" step="0.01" min="0" max="99" oninput="calculate_equipment_cost()">
                        </div>
                        <div>
                            <label>開發費</label>
                            <input type="number" id="development_fee" placeholder="例: 50000" step="0.01" oninput="calculate_equipment_cost()">
                        </div>
                    </div>
                    <!-- 計算結果顯示區域 -->
                    <div class="equipment-result-box">
                        <div class="equipment-formula">📊 計算公式</div>
                        <div class="equipment-formula-detail">
                            報價總金額 = {[每KW價格 ÷ (1 - 利潤率%)] + 開發費} × 建置容量
                        </div>
                        <div class="equipment-result">
                            計算結果: <span id="equipment_cost_result">請輸入參數</span>
                        </div>
                    </div>
                    <div class="help-text">系統會自動計算設備總費用作為初始投資金額</div>
                </div>

                <!-- 電費收入設定區域 -->
                <div class="input-group">
                    <label class="input-label">⚡ 電費收入</label>
                    <div class="mode-selector">
                        <label>
                            <input type="radio" name="income_mode" value="yearly" checked onchange="toggle_mode('income')">
                            每年不同
                        </label>
                        <label>
                            <input type="radio" name="income_mode" value="range" onchange="toggle_mode('income')">
                            年份範圍攤平
                        </label>
                        <label>
                            <input type="radio" name="income_mode" value="kw_based" onchange="toggle_mode('income')">
                            以KW計算
                        </label>
                    </div>
                    <!-- 每年不同輸入模式 -->
                    <div id="income_yearly" class="mode-content">
                        <input type="text" id="income_yearly_input" placeholder="例: 100000:105000:110000:115000">
                        <div class="help-text">請用冒號(:)分隔每年的收入金額</div>
                    </div>
                    <!-- 年份範圍攤平輸入模式 -->
                    <div id="income_range" class="mode-content hidden">
                        <input type="number" id="income_total_amount" placeholder="總金額" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="income_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('income')">
                                <input type="range" id="income_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('income')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="income_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('income')">
                                <span>到</span>
                                <input type="number" id="income_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('income')">
                            </div>
                        </div>
                        <div class="help-text">輸入總金額，選擇攤平的年份範圍</div>
                    </div>
                    <!-- 以KW計算輸入模式 -->
                    <div id="income_kw_based" class="mode-content hidden">
                        <input type="number" id="income_price_per_kw" placeholder="每KW價格" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="income_kw_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('income_kw')">
                                <input type="range" id="income_kw_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('income_kw')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="income_kw_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('income_kw')">
                                <span>到</span>
                                <input type="number" id="income_kw_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('income_kw')">
                            </div>
                        </div>
                        <div class="help-text">總金額 = 每KW價格 × 建置容量，在選定年份範圍內攤平</div>
                    </div>
                </div>

                <!-- 利息費用設定區域 -->
                <div class="input-group">
                    <label class="input-label">💸 利息費用</label>

                    <!-- 無利息選項 -->
                    <div style="margin-bottom: 15px;">
                        <label>
                            <input type="checkbox" id="no_interest_checkbox" onchange="toggle_interest_mode()">
                            無利息
                        </label>
                    </div>

                    <!-- 銀行貸款參數 -->
                    <div id="bank_loan_params" class="mode-content">
                        <div style="display: flex; gap: 15px; margin-bottom: 10px; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 120px;">
                                <label style="display: block; margin-bottom: 5px; font-size: 0.9em;">貸款成數 (%)</label>
                                <input type="number" id="loan_ratio" placeholder="80" min="0" max="100" step="1">
                            </div>
                            <div style="flex: 1; min-width: 120px;">
                                <label style="display: block; margin-bottom: 5px; font-size: 0.9em;">銀行利率 (%)</label>
                                <input type="number" id="bank_rate" placeholder="2.5" min="0" max="20" step="0.1">
                            </div>
                            <div style="flex: 1; min-width: 120px;">
                                <label style="display: block; margin-bottom: 5px; font-size: 0.9em;">攤還期數 (年)</label>
                                <input type="number" id="repayment_period" placeholder="15" min="1" max="50" step="1">
                            </div>
                        </div>
                        <div class="help-text">
                            系統將自動計算每年的利息費用<br>
                            第1年利息 = (設備成本 × 貸款成數) × 銀行利率<br>
                            之後每年利息會隨著本金攤還而遞減
                        </div>
                    </div>
                </div>

                <!-- 租金設定區域 -->
                <div class="input-group">
                    <label class="input-label">🏠 租金</label>
                    <div class="mode-selector">
                        <label>
                            <input type="radio" name="rent_mode" value="yearly" checked onchange="toggle_mode('rent')">
                            每年不同
                        </label>
                        <label>
                            <input type="radio" name="rent_mode" value="range" onchange="toggle_mode('rent')">
                            年份範圍攤平
                        </label>
                        <label>
                            <input type="radio" name="rent_mode" value="kw_based" onchange="toggle_mode('rent')">
                            以KW計算
                        </label>
                    </div>
                    <!-- 每年不同輸入模式 -->
                    <div id="rent_yearly" class="mode-content">
                        <input type="text" id="rent_yearly_input" placeholder="例: 20000:20000:20000:20000">
                        <div class="help-text">請用冒號(:)分隔每年的租金</div>
                    </div>
                    <!-- 年份範圍攤平輸入模式 -->
                    <div id="rent_range" class="mode-content hidden">
                        <input type="number" id="rent_total_amount" placeholder="總金額" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="rent_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('rent')">
                                <input type="range" id="rent_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('rent')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="rent_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('rent')">
                                <span>到</span>
                                <input type="number" id="rent_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('rent')">
                            </div>
                        </div>
                        <div class="help-text">輸入總金額，選擇攤平的年份範圍</div>
                    </div>
                    <!-- 以KW計算輸入模式 -->
                    <div id="rent_kw_based" class="mode-content hidden">
                        <input type="number" id="rent_price_per_kw" placeholder="每KW價格" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="rent_kw_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('rent_kw')">
                                <input type="range" id="rent_kw_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('rent_kw')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="rent_kw_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('rent_kw')">
                                <span>到</span>
                                <input type="number" id="rent_kw_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('rent_kw')">
                            </div>
                        </div>
                        <div class="help-text">總金額 = 每KW價格 × 建置容量，在選定年份範圍內攤平</div>
                    </div>
                </div>

                <!-- 運維費用設定區域 -->
                <div class="input-group">
                    <label class="input-label">🔧 運維費用</label>
                    <div class="mode-selector">
                        <label>
                            <input type="radio" name="maintenance_mode" value="yearly" checked onchange="toggle_mode('maintenance')">
                            每年不同
                        </label>
                        <label>
                            <input type="radio" name="maintenance_mode" value="range" onchange="toggle_mode('maintenance')">
                            年份範圍攤平
                        </label>
                        <label>
                            <input type="radio" name="maintenance_mode" value="kw_based" onchange="toggle_mode('maintenance')">
                            以KW計算
                        </label>
                    </div>
                    <!-- 每年不同輸入模式 -->
                    <div id="maintenance_yearly" class="mode-content">
                        <input type="text" id="maintenance_yearly_input" placeholder="例: 15000:16000:17000:18000">
                        <div class="help-text">請用冒號(:)分隔每年的運維費用</div>
                    </div>
                    <!-- 年份範圍攤平輸入模式 -->
                    <div id="maintenance_range" class="mode-content hidden">
                        <input type="number" id="maintenance_total_amount" placeholder="總金額" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="maintenance_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('maintenance')">
                                <input type="range" id="maintenance_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('maintenance')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="maintenance_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('maintenance')">
                                <span>到</span>
                                <input type="number" id="maintenance_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('maintenance')">
                            </div>
                        </div>
                        <div class="help-text">輸入總金額，選擇攤平的年份範圍</div>
                    </div>
                    <!-- 以KW計算輸入模式 -->
                    <div id="maintenance_kw_based" class="mode-content hidden">
                        <input type="number" id="maintenance_price_per_kw" placeholder="每KW價格" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="maintenance_kw_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('maintenance_kw')">
                                <input type="range" id="maintenance_kw_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('maintenance_kw')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="maintenance_kw_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('maintenance_kw')">
                                <span>到</span>
                                <input type="number" id="maintenance_kw_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('maintenance_kw')">
                            </div>
                        </div>
                        <div class="help-text">總金額 = 每KW價格 × 建置容量，在選定年份範圍內攤平</div>
                    </div>
                </div>

                <!-- 保險費設定區域 -->
                <div class="input-group">
                    <label class="input-label">🛡️ 保險費</label>
                    <div class="mode-selector">
                        <label>
                            <input type="radio" name="insurance_mode" value="yearly" checked onchange="toggle_mode('insurance')">
                            每年不同
                        </label>
                        <label>
                            <input type="radio" name="insurance_mode" value="range" onchange="toggle_mode('insurance')">
                            年份範圍攤平
                        </label>
                        <label>
                            <input type="radio" name="insurance_mode" value="kw_based" onchange="toggle_mode('insurance')">
                            以KW計算
                        </label>
                    </div>
                    <!-- 每年不同輸入模式 -->
                    <div id="insurance_yearly" class="mode-content">
                        <input type="text" id="insurance_yearly_input" placeholder="例: 5000:5000:5000:5000">
                        <div class="help-text">請用冒號(:)分隔每年的保險費</div>
                    </div>
                    <!-- 年份範圍攤平輸入模式 -->
                    <div id="insurance_range" class="mode-content hidden">
                        <input type="number" id="insurance_total_amount" placeholder="總金額" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="insurance_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('insurance')">
                                <input type="range" id="insurance_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('insurance')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="insurance_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('insurance')">
                                <span>到</span>
                                <input type="number" id="insurance_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('insurance')">
                            </div>
                        </div>
                        <div class="help-text">輸入總金額，選擇攤平的年份範圍</div>
                    </div>
                    <!-- 以KW計算輸入模式 -->
                    <div id="insurance_kw_based" class="mode-content hidden">
                        <input type="number" id="insurance_price_per_kw" placeholder="每KW價格" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="insurance_kw_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('insurance_kw')">
                                <input type="range" id="insurance_kw_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('insurance_kw')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="insurance_kw_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('insurance_kw')">
                                <span>到</span>
                                <input type="number" id="insurance_kw_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('insurance_kw')">
                            </div>
                        </div>
                        <div class="help-text">總金額 = 每KW價格 × 建置容量，在選定年份範圍內攤平</div>
                    </div>
                </div>

                <!-- 模組回收費設定區域 -->
                <div class="input-group">
                    <label class="input-label">♻️ 模組回收費</label>
                    <div class="mode-selector">
                        <label>
                            <input type="radio" name="recycling_mode" value="yearly" checked onchange="toggle_mode('recycling')">
                            每年不同
                        </label>
                        <label>
                            <input type="radio" name="recycling_mode" value="range" onchange="toggle_mode('recycling')">
                            年份範圍攤平
                        </label>
                        <label>
                            <input type="radio" name="recycling_mode" value="kw_based" onchange="toggle_mode('recycling')">
                            以KW計算
                        </label>
                    </div>
                    <!-- 每年不同輸入模式 -->
                    <div id="recycling_yearly" class="mode-content">
                        <input type="text" id="recycling_yearly_input" placeholder="例: 0:0:0:30000">
                        <div class="help-text">請用冒號(:)分隔每年的模組回收費</div>
                    </div>
                    <!-- 年份範圍攤平輸入模式 -->
                    <div id="recycling_range" class="mode-content hidden">
                        <input type="number" id="recycling_total_amount" placeholder="總金額" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="recycling_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('recycling')">
                                <input type="range" id="recycling_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('recycling')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="recycling_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('recycling')">
                                <span>到</span>
                                <input type="number" id="recycling_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('recycling')">
                            </div>
                        </div>
                        <div class="help-text">輸入總金額，選擇攤平的年份範圍</div>
                    </div>
                    <!-- 以KW計算輸入模式 -->
                    <div id="recycling_kw_based" class="mode-content hidden">
                        <input type="number" id="recycling_price_per_kw" placeholder="每KW價格" style="margin-bottom:10px;">
                        <div class="range-slider-container">
                            <label>攤平年份範圍：</label>
                            <div class="year-range-slider">
                                <input type="range" id="recycling_kw_start_range" min="2025" max="2030" value="2025" oninput="updateRangeDisplay('recycling_kw')">
                                <input type="range" id="recycling_kw_end_range" min="2025" max="2030" value="2030" oninput="updateRangeDisplay('recycling_kw')">
                            </div>
                            <div class="year-range-inputs">
                                <input type="number" id="recycling_kw_start_year" placeholder="起始年" value="2025" min="2025" max="2030" oninput="updateRangeFromInput('recycling_kw')">
                                <span>到</span>
                                <input type="number" id="recycling_kw_end_year" placeholder="結束年" value="2030" min="2025" max="2030" oninput="updateRangeFromInput('recycling_kw')">
                            </div>
                        </div>
                        <div class="help-text">總金額 = 每KW價格 × 建置容量，在選定年份範圍內攤平</div>
                    </div>
                </div>

                <!-- 所得稅率設定區域 -->
                <div class="input-group">
                    <label class="input-label">💰 所得稅率</label>
                    <input type="number" id="tax_rate" placeholder="例: 20" min="0" max="100" step="0.1">
                    <div class="help-text">輸入所得稅率百分比（例：20 代表20%）</div>
                </div>

                <!-- 現金流量表參數設定區域 -->
                <div class="input-group">
                    <label class="input-label">💼 現金流量表參數</label>
                    <div style="display: flex; gap: 15px; margin-bottom: 10px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 150px;">
                            <label style="display: block; margin-bottom: 5px; font-size: 0.9em;">股利比率 (%)</label>
                            <input type="number" id="dividend_ratio" placeholder="例: 50" min="0" max="100" step="0.1">
                        </div>
                        <div style="flex: 1; min-width: 150px;">
                            <label style="display: block; margin-bottom: 5px; font-size: 0.9em;">年底減資攤提期數 (年)</label>
                            <input type="number" id="capital_reduction_period" placeholder="例: 5" min="1" max="50" step="1">
                        </div>
                    </div>
                    <div class="help-text">
                        股利比率：現金股利 = 稅後淨利 × 股利比率<br>
                        年底減資攤提期數：年底減資會在最後N年平均分攤
                    </div>
                </div>

                <!-- 計算按鈕 -->
                <button class="calculate-btn" onclick="calculate_irr_main()">🚀 計算 IRR</button>
            </div>

            <!-- 計算結果顯示區域 -->
            <div class="result-section">
                <h2 class="section-title">📈 計算結果</h2>
                <div id="result_container">
                    <div class="result-display">
                        <div class="success">✅ IRR 計算器已準備就緒</div>
                        <p style="text-align: center; margin-top: 15px;">請填入相關數據後點擊計算按鈕</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入JavaScript文件 -->
    <script src="{{ url_for('static', filename='api_client.js') }}"></script>
    <script src="{{ url_for('static', filename='irr_ui.js') }}"></script>
</body>
</html>
